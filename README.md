# basic-component

## 决策

* env负责硬件，系统，k8s集群创建部分。其他基础组件basic-component负责,包括containerd, k8s的运维部分
* env0.luojm.com指向对外服务虚Ip(可能是master虚ip,也可能是ingress虚Ip)

## 诡异现象

 华为路由器nat至少要配置1111-》1111这样的端口映射，
 才可以转发443的端口映射
 新路由器回来再做测试

 tplink企业路由器没有这个问题。可以确定是华为家庭路由器的问题


## FAQ

### 在80/443端口被封情况下，在光猫拨号情况下做端口映射, 则内网通过公网端口映射进来是访问不到服务的。用外网访问正常。

NAT映射回流问题。是为端口映射通用问题。
内网用户通过公网请求则以内网ip为源ip, 通过外网到光猫映射到内网服务器, 服务器返回的数据包的时候，发现是内网的机器发的请求，
再出去的时候，光猫就直接给了内网用户。用户收到地址发送回来的ip是内网地址，而不是出去时候的外网地址，就丢掉这个包了
为什么换成路由器拨号能够解决这个问题呢
是因为路由器遇到这种情况，也将包发给外网再回流回来。路由器偷偷解决了这个问题
所以要解决问题，要不然就是选择这样的路由器。或者路由器上要配置路由策略来解决
（以上为资料得知，未做实验验证)

### 为什么不做80转443

基础组件的地址用户不需要使用，不需要转。用户需要的再做80转443
为什么基础组件必须https
. 安全
. 基础组件路有规则只有443情况一条路,简单

### 什么时候用二级域名，什么时候用slash

平台级组件用二级域名，因为他们的CONSOLE往往用slash还需要ridirect url跳过slash部分
minio.env0.luojm.com
k8s.env0.luojm.com
warmth.env0.luojm.com

### traefik dash, k8s dash是否需要支持https

* 反正其他服务也要支持，增加支持了就好

### 为什么不做成每个项目隔离使用组件

每个项目单独拥有自己的minio, cassandra, cert-manager等等，固然有好处
但是共享也有好处。这个是个取舍。

隔离的好处： 
	* 一个出问题不会影响另外一个项目
	* 能分开升级
  
共享的好处： 
	* 不用维护两份
	* 新项目更快
	* 不费硬件性能

共享的好处，显而易见。而隔离的好处，真的那么容易出问题？
如果你是使用云上的Minion，人家也不会给你搞成每个用户起个进程。只是给你配个租户而已。
最终的目的，做成基础组件十足强大的平台。甚至可以出租出去给其他人用的水平。
新的项目，也可以马上得到这份能力。

还有，如果隔离，升级，等等都费能力。
只有一个好处： 出问题不会影响其他项目，太过空洞。

另外现状还是将来，效率为王。永远不要多花人力。简单一点。

稳定角度，确实隔离更好。这个无可否认。
每个项目自己一套，美滋滋。
但是这些项目，还有有点学习曲线的。经验加成。让一个团队，搞好这些基础支持。其他项目共享之。
先是共享。数据中心每个app搞一套，需要预算资源。虽然可以后续动态增加。
共享数据中心，还是隔离？

真需要隔离的项目，稳定性达到非常高。能赚钱，流量高。单独搞一套机器去隔离好了。部署env+共享
设备都共享的，k8s也共享的，数据库独立共享。

最终决策： 隔离占资源。费能力维护。而稳定性好处在目前阶段看不到。共享之。

### 为什么minio operator不设置部署到哪个节点

operator默认策略 部署2个够用了（一个Leader， 一个slave）。主要的性能还是在于tenant
tenant用的worker node设置亲和性才是需要的